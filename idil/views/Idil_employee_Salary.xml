<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <!-- TREE VIEW -->
    <record id="view_idil_employee_salary_tree" model="ir.ui.view">
        <field name="name">idil.employee.salary.tree</field>
        <field name="model">idil.employee.salary</field>
        <field name="arch" type="xml">
            <tree string="Salaries">
                <field name="employee_id"/>
                <field name="salary_date"/>
                <field name="employee_account_id"/>
                <field name="employee_account_currency_id"/>
                <field name="account_id"/>
                <field name="payout_account_currency_id"/>

                <field name="basic_salary" sum="Total"/>
                <field name="bonus" sum="Total"/>
                <field name="deductions" sum="Total"/>
                <field name="advance_deduction" sum="Total"/>
                <field name="total_pending_sales" sum="Total"/>
                <field name="total_deductions" sum="Total"/>
                <field name="total_salary" sum="Total"/>

                <field name="total_salary_usd" sum="Total USD"/>
                <field name="is_paid"/>
            </tree>
        </field>
    </record>


    <!-- FORM VIEW -->
    <record id="view_idil_employee_salary_form" model="ir.ui.view">
        <field name="name">idil.employee.salary.form</field>
        <field name="model">idil.employee.salary</field>
        <field name="arch" type="xml">
            <form string="ðŸ’¼ Employee Salary" class="o_form_full o_form_nosheet">

                <sheet>

                    <!-- TITLE -->
                    <div class="oe_title">
                        <h1 class="mb-1">
                            Employee Salary
                            <span class="ms-2 badge rounded-pill bg-light border text-muted px-3 py-2">
                                <i class="fa fa-user me-1"/>
                                <field name="employee_id" nolabel="1"/>
                            </span>
                        </h1>

                        <div class="text-muted mt-1">
                            <i class="fa fa-info-circle me-1"/>
                            Review salary components, verify exchange rate, and print the payment slip once confirmed.
                        </div>
                    </div>

                    <!-- ACTION BUTTONS -->
                    <div class="mt-3 d-flex gap-2 flex-wrap">
                        <button name="action_generate_salary_report_pdf"
                                string="ðŸ–¨ï¸ Print Payment Slip"
                                type="object"
                                class="btn-primary"/>

                        <button name="generate_balance_sheet_report_pdf"
                                string="ðŸ“Š Print Balance Sheet Report"
                                type="object"
                                class="btn-info"/>
                    </div>

                    <!-- TOP CARDS -->
                    <div class="row g-3 mt-3">

                        <!-- LEFT CARD: Employee + Accounts -->
                        <div class="col-12 col-lg-7">
                            <div class="border rounded-4 p-4 shadow-sm bg-white h-100">

                                <div class="fw-bold mb-3 d-flex align-items-center gap-2">
                                    <i class="fa fa-id-badge text-muted"/>
                                    <span>Employee &amp; Accounts</span>
                                </div>

                                <group col="2">
                                    <field name="employee_id" options="{'no_create': True}"/>
                                    <field name="salary_date"/>

                                    <field name="employee_account_id" readonly="1"/>
                                    <field name="employee_account_currency_id" readonly="1"/>

                                    <field name="account_id" options="{'no_create': True}"/>
                                    <field name="payout_account_currency_id" readonly="1"/>
                                </group>

                                <div class="alert alert-info mt-3 mb-0">
                                    <i class="fa fa-lightbulb-o me-1"/>
                                    Tip: Payout posting uses the <b>Payout Account Currency</b>. If it differs from expense currency, clearing accounts will be used.
                                </div>

                            </div>
                        </div>

                        <!-- RIGHT CARD: Controls + FX -->
                        <div class="col-12 col-lg-5">
                            <div class="border rounded-4 p-4 shadow-sm bg-white h-100">

                                <div class="fw-bold mb-3 d-flex align-items-center gap-2">
                                    <i class="fa fa-exchange text-muted"/>
                                    <span>Controls &amp; Exchange</span>
                                </div>

                                <group col="1">
                                    <field name="is_paid"/>
                                    <field name="currency_id" readonly="1"/>
                                    <field name="rate" readonly="1"/>
                                    <field name="remarks"/>
                                </group>

                                <div class="alert alert-secondary mt-3 mb-0">
                                    <i class="fa fa-shield me-1"/>
                                    Ensure exchange rate is correct before printing. USD totals are calculated from SL totals using the rate.
                                </div>

                            </div>
                        </div>

                    </div>


                    <!-- SALARY COMPONENTS CARD (SL) -->
                    <div class="row g-3 mt-3">
                        <div class="col-12">
                            <div class="border rounded-4 p-4 shadow-sm bg-white">

                                <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                                    <div class="fw-bold d-flex align-items-center gap-2">
                                        <i class="fa fa-calculator text-muted"/>
                                        <span>Salary Components (SL)</span>
                                    </div>

                                    <div class="d-flex gap-2 flex-wrap">
                                        <span class="badge rounded-pill bg-light border px-3 py-2">
                                            <i class="fa fa-clock-o me-1"/>
                                            Days:
                                            <field name="number_of_days" nolabel="1" class="ms-1"/>
                                        </span>
                                        <span class="badge rounded-pill bg-light border px-3 py-2">
                                            <i class="fa fa-check-circle me-1"/>
                                            Net Salary:
                                            <field name="total_salary" nolabel="1" readonly="1" class="ms-1"/>
                                        </span>
                                    </div>
                                </div>

                                <div class="row g-3">

                                    <!-- Earnings -->
                                    <div class="col-12 col-lg-6">
                                        <div class="border rounded-4 p-3 bg-light h-100">
                                            <div class="fw-bold mb-2 d-flex align-items-center gap-2">
                                                <i class="fa fa-plus-circle text-muted"/>
                                                <span>Earnings</span>
                                            </div>

                                            <group col="2">
                                                <field name="basic_salary" readonly="1"/>
                                                <field name="bonus"/>
                                                <field name="salary_by_days" readonly="1"/>
                                                <field name="total_earnings" readonly="1" class="oe_highlight"/>
                                            </group>

                                            <div class="text-muted mt-2">
                                                Basic Salary is taken from employee profile. Salary by Days = Basic Salary Ã— Days.
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Deductions -->
                                    <div class="col-12 col-lg-6">
                                        <div class="border rounded-4 p-3 bg-light h-100">
                                            <div class="fw-bold mb-2 d-flex align-items-center gap-2">
                                                <i class="fa fa-minus-circle text-muted"/>
                                                <span>Deductions</span>
                                            </div>

                                            <group col="2">
                                                <field name="deductions"/>
                                                <field name="advance_deduction"/>
                                                <field name="total_pending_sales" readonly="1" class="oe_highlight"/>
                                                <field name="total_deductions" readonly="1" class="oe_highlight"/>
                                            </group>

                                            <div class="text-muted mt-2">
                                                Total Deductions = Deductions + Advance Salary + Pending Staff Sales.
                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>


                    <!-- NET SALARY (SL) CARD -->
                    <div class="row g-3 mt-3">
                        <div class="col-12">
                            <div class="border rounded-4 p-4 shadow-sm bg-white">
                                <div class="fw-bold mb-2 d-flex align-items-center gap-2">
                                    <i class="fa fa-money text-muted"/>
                                    <span>Net Salary (SL)</span>
                                </div>

                                <group col="2">
                                    <field name="total_salary" readonly="1" class="oe_highlight"/>
                                </group>

                                <div class="alert alert-info mt-3 mb-0">
                                    <i class="fa fa-info-circle me-1"/>
                                    Net Salary = Total Earnings âˆ’ (Deductions + Advance Salary + Pending Sales).
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- USD DISPLAY CARD -->
                    <div class="row g-3 mt-3">
                        <div class="col-12">
                            <div class="border rounded-4 p-4 shadow-sm bg-white">

                                <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                                    <div class="fw-bold d-flex align-items-center gap-2">
                                        <i class="fa fa-usd text-muted"/>
                                        <span>USD View (Display Only)</span>
                                    </div>

                                    <div class="text-muted">
                                        <i class="fa fa-exchange me-1"/>
                                        Uses Rate:
                                        <field name="rate" nolabel="1" readonly="1" class="ms-1"/>
                                    </div>
                                </div>

                                <div class="row g-3">

                                    <div class="col-12 col-lg-6">
                                        <div class="border rounded-4 p-3 bg-light h-100">
                                            <div class="fw-bold mb-2 d-flex align-items-center gap-2">
                                                <i class="fa fa-plus-circle text-muted"/>
                                                <span>Earnings (USD)</span>
                                            </div>

                                            <group col="2">
                                                <field name="basic_salary_usd" readonly="1"/>
                                                <field name="bonus_usd" readonly="1"/>
                                                <field name="salary_by_days_usd" readonly="1"/>
                                                <field name="total_earnings_usd" readonly="1" class="oe_highlight"/>
                                            </group>
                                        </div>
                                    </div>

                                    <div class="col-12 col-lg-6">
                                        <div class="border rounded-4 p-3 bg-light h-100">
                                            <div class="fw-bold mb-2 d-flex align-items-center gap-2">
                                                <i class="fa fa-minus-circle text-muted"/>
                                                <span>Deductions (USD)</span>
                                            </div>

                                            <group col="2">
                                                <field name="deductions_usd" readonly="1"/>
                                                <field name="advance_deduction_usd" readonly="1"/>
                                                <field name="total_pending_sales_usd" readonly="1" class="oe_highlight"/>
                                                <field name="total_deductions_usd" readonly="1" class="oe_highlight"/>
                                            </group>
                                        </div>
                                    </div>

                                </div>

                                <div class="alert alert-secondary mt-3 mb-0">
                                    <i class="fa fa-eye me-1"/>
                                    These USD fields are for display only. Posting uses account currencies and exchange clearing when needed.
                                </div>

                            </div>
                        </div>
                    </div>


                    <!-- NET SALARY USD -->
                    <div class="row g-3 mt-3">
                        <div class="col-12">
                            <div class="border rounded-4 p-4 shadow-sm bg-white">
                                <div class="fw-bold mb-2 d-flex align-items-center gap-2">
                                    <i class="fa fa-usd text-muted"/>
                                    <span>Net Salary (USD)</span>
                                </div>

                                <group col="2">
                                    <field name="total_salary_usd" readonly="1" class="oe_highlight"/>
                                </group>
                            </div>
                        </div>
                    </div>

                    <notebook class="mt-4">

                        <page string="Salary Advances This Month">
                            <div class="border rounded-4 p-4 shadow-sm bg-white">
                                <div class="fw-bold mb-3 d-flex align-items-center gap-2">
                                    <i class="fa fa-calendar text-muted"/>
                                    <span>Salary Advances This Month</span>
                                </div>

                                <field name="advances_this_month" nolabel="1" readonly="1">
                                    <tree string="Salary Advances">
                                        <field name="request_date"/>
                                        <field name="currency_id"/>
                                        <field name="advance_amount" sum="Total"/>
                                        <field name="state"/>
                                        <field name="remarks"/>
                                    </tree>
                                </field>

                                <div class="text-muted mt-2">
                                    These are approved/deducted advances within the salary month.
                                </div>
                            </div>
                        </page>

                        <page string="Pending Staff Sales">
                            <div class="border rounded-4 p-4 shadow-sm bg-white">
                                <div class="fw-bold mb-3 d-flex align-items-center gap-2">
                                    <i class="fa fa-list-ul text-muted"/>
                                    <span>Pending Staff Sales</span>
                                </div>

                                <field name="pending_sales_ids" nolabel="1" readonly="1">
                                    <tree>
                                        <field name="name"/>
                                        <field name="sales_date"/>
                                        <field name="total_amount" sum="Total"/>
                                        <field name="payment_status"/>
                                        <field name="state"/>
                                    </tree>
                                </field>

                                <div class="text-muted mt-2">
                                    Any pending staff sales will be deducted automatically in salary totals.
                                </div>
                            </div>
                        </page>

                    </notebook>

                </sheet>

                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>

            </form>
        </field>
    </record>


    <!-- ACTION -->
    <record id="action_idil_employee_salary" model="ir.actions.act_window">
        <field name="name">Salaries</field>
        <field name="res_model">idil.employee.salary</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{}</field>
    </record>

</odoo>
