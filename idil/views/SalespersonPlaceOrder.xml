<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ===================================================== -->
    <!-- ðŸš€ Action (Tree first)                                 -->
    <!-- ===================================================== -->
 
    <!-- ===================================================== -->
    <!-- ðŸ”Ž Search View                                         -->
    <!-- ===================================================== -->
    <record id="view_salesperson_order_search" model="ir.ui.view">
        <field name="name">salesperson.order.search</field>
        <field name="model">idil.salesperson.place.order</field>
        <field name="arch" type="xml">
            <search string="ðŸ”Ž Search Team Orders">
                <field name="name" string="ðŸ”– Ref"/>
                <field name="salesperson_id" string="ðŸ§‘ Salesperson"/>
                <field name="order_date" string="ðŸ“… Date"/>

                <separator/>

                <filter name="draft" string="ðŸ“ Draft" domain="[('state','=','draft')]"/>
                <filter name="confirmed" string="âœ… Confirmed" domain="[('state','=','confirmed')]"/>
                <filter name="cancel" string="â›” Cancelled" domain="[('state','=','cancel')]"/>

                <group expand="0" string="ðŸ“Š Group By">
                    <filter name="group_salesperson" string="ðŸ§‘ Salesperson" context="{'group_by':'salesperson_id'}"/>
                    <filter name="group_date" string="ðŸ“… Date" context="{'group_by':'order_date'}"/>
                    <filter name="group_state" string="ðŸ·ï¸ Status" context="{'group_by':'state'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- ===================================================== -->
    <!-- ðŸ§¾ Tree View                                           -->
    <!-- ===================================================== -->
    <record id="view_salesperson_order_tree" model="ir.ui.view">
        <field name="name">salesperson.order.tree</field>
        <field name="model">idil.salesperson.place.order</field>
        <field name="arch" type="xml">
            <tree string="ðŸ§¾ Team Orders" default_order="id desc"
                  create="1" delete="0"
                  decoration-muted="state == 'cancel'"
                  decoration-info="state == 'draft'"
                  decoration-success="state == 'confirmed'">

                <field name="name" string="ðŸ”– Ref"/>
                <field name="order_date" string="ðŸ“… Date"/>
                <field name="salesperson_id" string="ðŸ§‘ Salesperson"/>
                <field name="total_quantity" string="ðŸ“¦ Total Qty" sum="Total"/>
                <field name="state" string="ðŸ·ï¸ Status" widget="badge"/>
            </tree>
        </field>
    </record>

    <!-- ===================================================== -->
    <!-- ðŸ§¾ Form View (Modern)                                  -->
    <!-- ===================================================== -->
    <record id="view_salesperson_order_form" model="ir.ui.view">
        <field name="name">salesperson.order.form</field>
        <field name="model">idil.salesperson.place.order</field>
        <field name="arch" type="xml">
            <form string="ðŸ§¾ Place Order by Sales Team" class="o_form_full o_form_nosheet">

                <!-- Header: Status pill -->
                <header>
                    <button name="action_view_barcode" string="Preview Barcode" type="object" class="btn-info" icon="fa-eye"/>
                    <button name="%(action_report_production_barcode_salesperson)d" string="Print Barcode Labels" type="action" class="btn-primary" icon="fa-barcode"/>
                    <span class="ms-2 badge rounded-pill bg-light border text-muted px-3 py-2">
                        <i class="fa fa-flag me-1"/>
                        Status:
                        <field name="state" widget="badge" readonly="1" class="ms-1"/>
                    </span>
                </header>

                <sheet>

                    <!-- Title -->
                    <div class="oe_title">
                        <h1 class="mb-1">
                            <i class="fa fa-shopping-basket me-2 text-primary"/>
                            Team Order
                            <span class="ms-2 badge rounded-pill bg-light border text-muted px-3 py-2">
                                <i class="fa fa-hashtag me-1"/>
                                <field name="name" readonly="1" nolabel="1"/>
                            </span>
                        </h1>
                        <div class="text-muted">
                            <i class="fa fa-info-circle me-1"/>
                            Create the teamâ€™s draft order. This order will later be used to generate a Sales Order.
                        </div>
                    </div>

                    <!-- Two cards -->
                    <div class="row g-3 mt-3">

                        <!-- Document -->
                        <div class="col-12 col-lg-7">
                            <div class="border rounded-4 p-3 shadow-sm bg-white h-100">
                                <div class="fw-bold mb-2 d-flex align-items-center gap-2 flex-wrap">
                                    <i class="fa fa-file-text-o text-muted"/>
                                    <span>Order Details</span>
                                </div>

                                <div class="d-grid gap-2">

                                    <div class="d-flex align-items-center gap-2 flex-wrap">
                                        <span class="text-muted" style="width:24px; text-align:center;">
                                            <i class="fa fa-hashtag"/>
                                        </span>
                                        <span class="o_form_label mb-0" style="min-width:160px;">Reference</span>
                                        <div class="flex-grow-1" style="min-width:260px;">
                                            <field name="name" nolabel="1" readonly="1" placeholder="Auto"/>
                                        </div>
                                    </div>

                                    <div class="d-flex align-items-center gap-2 flex-wrap">
                                        <span class="text-muted" style="width:24px; text-align:center;">
                                            <i class="fa fa-user"/>
                                        </span>
                                        <span class="o_form_label mb-0" style="min-width:160px;">Salesperson</span>
                                        <div class="flex-grow-1" style="min-width:260px;">
                                            <field name="salesperson_id" nolabel="1" options="{'no_create_edit': True}"/>
                                        </div>
                                    </div>

                                    <div class="d-flex align-items-center gap-2 flex-wrap">
                                        <span class="text-muted" style="width:24px; text-align:center;">
                                            <i class="fa fa-calendar"/>
                                        </span>
                                        <span class="o_form_label mb-0" style="min-width:160px;">Order Date</span>
                                        <div class="flex-grow-1" style="min-width:260px;">
                                            <field name="order_date" nolabel="1"/>
                                        </div>
                                    </div>

                                </div>

                                <div class="alert alert-info mt-3 mb-0" role="alert">
                                    <i class="fa fa-lightbulb-o me-1"/>
                                    Tip: Keep this order in <b>Draft</b> until the salesperson confirms quantities.
                                </div>
                            </div>
                        </div>

                        <!-- Summary -->
                        <div class="col-12 col-lg-5">
                            <div class="border rounded-4 p-3 shadow-sm bg-white h-100">
                                <div class="fw-bold mb-2 d-flex align-items-center gap-2 flex-wrap">
                                    <i class="fa fa-calculator text-muted"/>
                                    <span>Summary</span>
                                </div>

                                <div class="d-grid gap-2">
                                    <div class="d-flex align-items-center gap-2 flex-wrap">
                                        <span class="text-muted" style="width:24px; text-align:center;">
                                            <i class="fa fa-cubes"/>
                                        </span>
                                        <span class="o_form_label mb-0" style="min-width:160px;">Total Quantity</span>
                                        <div class="flex-grow-1" style="min-width:220px;">
                                            <field name="total_quantity" nolabel="1" readonly="1"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-3">
                                    <div class="badge rounded-pill bg-light border text-muted px-3 py-2">
                                        <i class="fa fa-shield me-1"/>
                                        Totals are computed from order lines.
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>

                    <!-- Notebook -->
                    <notebook class="mt-3">

                        <!-- Lines -->
                        <page string="ðŸ“‹ Order Lines">
                            <div class="border rounded-4 p-3 shadow-sm bg-white">

                                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
                                    <div class="fw-bold d-flex align-items-center gap-2">
                                        <i class="fa fa-list-ul text-muted"/>
                                        <span>Products</span>
                                    </div>

                                    <span class="badge rounded-pill bg-light border text-muted px-3 py-2">
                                        ðŸ“¦ Total Qty:
                                        <field name="total_quantity" nolabel="1" readonly="1" class="ms-1"/>
                                    </span>
                                </div>

                                <field name="order_lines" nolabel="1" context="{'default_order_id': active_id}">
                                    <tree editable="bottom" string="Lines" delete="false">
                                        <field name="product_id" string="ðŸ“¦ Product" options="{'no_open': True}"/>
                                        <field name="quantity" string="ðŸ§® Qty" sum="Total Quantity"/>
                                    </tree>
                                    <form string="Line">
                                        <group>
                                            <field name="product_id" options="{'no_open': True}"/>
                                            <field name="quantity"/>
                                        </group>
                                    </form>
                                </field>

                                <div class="text-muted mt-2">
                                    <i class="fa fa-info-circle me-1"/>
                                    Add products and quantities. This draft order is used later when creating a Sales Order.
                                </div>

                            </div>
                        </page>

                        <!-- Chatter -->
                        <page string="ðŸ’¬ Chatter">
                            <field name="message_follower_ids" widget="mail_followers"/>
                            <field name="activity_ids" widget="mail_activity"/>
                            <field name="message_ids" widget="mail_thread"/>
                        </page>

                    </notebook>

                </sheet>
            </form>
        </field>
    </record>

    <!-- ===================================================== -->
    <!-- PIVOT + GRAPH                                          -->
    <!-- ===================================================== -->
    <record id="view_salesperson_order_pivot" model="ir.ui.view">
        <field name="name">salesperson.order.pivot</field>
        <field name="model">idil.salesperson.place.order</field>
        <field name="arch" type="xml">
            <pivot string="Orders (Pivot)" stacked="True">
                <field name="total_quantity" type="measure"/>
                <field name="salesperson_id" type="row"/>
                <field name="order_date" interval="month" type="col"/>
            </pivot>
        </field>
    </record>

    <record id="view_salesperson_order_graph" model="ir.ui.view">
        <field name="name">salesperson.order.graph</field>
        <field name="model">idil.salesperson.place.order</field>
        <field name="arch" type="xml">
            <graph string="Orders (Graph)" type="bar">
                <field name="order_date" interval="day"/>
                <field name="total_quantity" type="measure"/>
                <field name="salesperson_id" group="True"/>
            </graph>
        </field>
    </record>
    
   <record id="action_salesperson_order_tree" model="ir.actions.act_window">
        <field name="name">ðŸ§¾ Place Order by Sales Team</field>
        <field name="res_model">idil.salesperson.place.order</field>
        <field name="view_mode">tree,form,pivot,graph</field>
        <field name="search_view_id" ref="view_salesperson_order_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Create your first team order</p>
            <p>Use filters for Draft/Confirmed and group by date or salesperson.</p>
        </field>
    </record>

</odoo>
